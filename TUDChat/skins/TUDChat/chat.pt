<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
  metal:use-macro="here/main_template/macros/master" i18n:domain="plone">


<head>
  <title>Chat</title>

<metal:block metal:fill-slot="javascript_head_slot">
    <script language="javascript" src="jquery-1.7.min.js"></script>
    <script language="javascript" src="jquery.ba-dotimeout.min.js"></script>
    <script language="javascript" src="hyperlink.js"></script>
    <script language="javascript" src="jquery.notification.js"></script>
    <script language="javascript" src="jquery.scroll.js"></script>
    <script language="javascript" tal:condition="python:here.isAdmin(here.REQUEST) == True" src="tud_chat_admin.js"></script>
    <script language="javascript" tal:condition="python:not here.isAdmin(here.REQUEST) == True" src="tud_chat_user.js"></script>
    <script language="javascript" src="tud_chat.js"></script>

    <script type="text/javascript" tal:content="structure string:var refreshRate = ${here/refreshRate} * 1000; var blockTime = ${here/blockTime} * 1000; var ownUsername = '${request/SESSION/user_properties/name|nothing}'; var base_url = '${here/absolute_url}'; var maxMessageLength = ${here/maxMessageLength}">
    </script>
</metal:block>

<metal:block metal:fill-slot="css_slot">
    <link rel="stylesheet" type="text/css" href="tud_chat.css" />
    <link rel="stylesheet" type="text/css" tal:condition="python:here.isAdmin(here.REQUEST) == True" href="tud_chat_admin.css" />
    <link rel="stylesheet" type="text/css" tal:attributes="href string:${here/absolute_url}/tud_chat_additional.css" />
</metal:block>

</head>


<body metal:fill-slot="main" i18n:domain="tudchat" tal:define="chatinfo python: here.getChatInfo(here.REQUEST)">
    <tal:block condition="chatinfo">
        <h2 tal:content="chatinfo/name"></h2>
        <tal:block condition="python: chatinfo['description']">
            <tal:block define="lines python:chatinfo['description'].splitlines()">
                <p class="chat_description">
                    <tal:block repeat="line lines">
                        <tal:block replace="line"></tal:block>
                        <br tal:condition="python: not repeat['line'].end">
                    </tal:block>
                </p>
            </tal:block>
        </tal:block>
        <div id="chat">
            <div id="chatUser">
                <ul id="userContainer">
                </ul>
            </div>
            <div id="chatContent">
                <ul id="chatContainer">
                </ul>
            </div>
            <div class="clear"></div>
            <div id="chatMsg">
                <form id="chatMsgForm">
                    <input type="text" name="msg" id="chatMsgValue" autocomplete="off" placeholder="Bitte geben Sie hier ihre Nachricht ein." tal:attributes="maxlength python: here.maxMessageLength>0 and here.maxMessageLength or None"/>
                    <span id="counter" tal:condition="python: here.maxMessageLength > 0"></span>
                    <button id="chatMsgSubmit" type="submit" class="simpleButton" title="Zum Absenden hier klicken oder 'Enter' drücken.">Absenden</button>
                </form>
            </div>
            <div class="clear"></div>
        </div>
        <div id="chatAppendix">

            <h3>Hinweise zur Benutzung:</h3>
            <div>
                Die Chaträume werden <em class='admin'>moderiert</em> und es können bei Fehlverhalten Konsequenzen in Form von einer Verwarnung und permanenter Verweisung des Chatraums folgen. <span class="chatDuration" tal:content="string: Dieser Chat ist bis zum ${chatinfo/end} aktiv und wird anschließend automatisch geschlossen."></span>
            </div>

            <h3>Chat verlassen:</h3>
            <div>
                <button id="logout">Chat verlassen</button>
            </div>
        </div>
    </tal:block>
</body>
</html>