g<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
<head>

  <metal:block metal:fill-slot="javascript_head_slot">
    <script type="text/javascript"
            tal:attributes="src string:$portal_url/plonechat.js">
    </script>
    <script type="text/javascript"
            tal:attributes="src string:$portal_url/plonechat_withTabs.js"
            tal:condition="here/getDisplayWithTabs">
    </script>      
  </metal:block>

  <metal:block metal:fill-slot="css_slot">
    <style type="text/css" media="all" tal:content="structure string:<!-- @import url($here_url/plonechat.css); -->"></style>
  </metal:block>

</head>

<body metal:fill-slot="main"
      i18n:domain="plonechat"
      tal:define="refresh_rate 		here/getRefreshRate;
                  refresh_rate 		python:refresh_rate * 1000;
                  ajaxurl 			string:getUnmoderatedMessages;
                  moderation_url 	string:moderateMessages;                  
                  inserturl 		string:insertNewMessage;
                  canPost 			here/canPost;
                  charset 			here/getCharset;
                  chatHeight 		here/getChatWindowHeight;
                  ajax_users_url 	string:getChatUsers;
                  onlyUpdate 		python:int(here.getOnlyUpdate());
                  login 			python: request.AUTHENTICATED_USER;"                  
    tal:attributes="onunload string:javascript:logout('logout')">


<form method="post" action="" name="chat">
   <ul id="active-users" tal:attributes="style string:display: none"></ul>
   <div id="chat-window"
           tal:attributes="	style 		string:height : ${chatHeight}px;
           					ondblclick 	string:editMessage(event);
           					onclick 	string:toggleCheckbox(event);"></div>

  <script type="text/javascript"
          tal:content="	structure string: 
	var interval = ${refresh_rate};
	var chat_height = ${chatHeight};
	var login = '${login}';
	var ajax_url = '${ajaxurl}';
	var onlyUpdate = ${onlyUpdate};
	var lastID = 0;
	var moderation = true;
	var msgList = document.getElementById('chat-window');
	var userList = document.getElementById('active-users');
    updateChat(); ">
  </script>

  <div tal:condition="canPost">
  	<div class="controlButtons">
      <div id="moderation-controls">	
      	<input 	type="button" value="Valider" class="context" name="Rejetter" 
             	tal:attributes="onclick string:simplePostRequest('${moderation_url}', getSelectedItems('chat-window') + 'mode=accept')" />
      	<input 	type="button" value="Supprimer" class="context" name="Valider" 
             	tal:attributes="onclick string:simplePostRequest('${moderation_url}', getSelectedItems('chat-window') + 'mode=del')" />
	  </div>
	  <input	class="context" type="button"
	  			value="See the logs"
          		i18n:attributes="value"
          		tal:attributes="onclick string:openLogsPopup('${here_url}/PloneChat_logs_view','500','400')"/>
	  <input 	class="context" type="button"
          		tal:condition="python:mtool.checkPermission('Manage portal',here)"
          		value="Clear logs"
          		i18n:attributes="value"
          		tal:attributes="onclick string:simpleAjaxRequest('${here_url}/clearLogs')"/>    	  
  	</div>
  </div>
</form>

</body>
</html>