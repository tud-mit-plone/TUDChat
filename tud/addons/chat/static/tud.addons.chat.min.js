!function(a){a.notification={},a.notification.options={style:{error:"notification notification_error",success:"notification notification_success",warn:"notification notification_warn",general:"notification notification_general"},autoClose:!0,clickToClose:!1,autoCloseTime:3e3,position:"",fadeInSpeed:"fast",fadeOutSpeed:250,time:6e3,moveSpeed:"fast",debug:!1},a.notification.error=function(b,c,d){return e._add(b,a.notification.options.style.error,c,d)},a.notification.success=function(b,c,d){return e._add(b,a.notification.options.style.success,c,d)},a.notification.warn=function(b,c,d){return e._add(b,a.notification.options.style.warn,c,d)},a.notification.general=function(b,c,d){return e._add(b,a.notification.options.style.general,c,d)},a.notification.clear=function(){a.each(d,function(a){e._remove(d[a],!1)}),d=[],e._overlay.hide()},a.notification.close=function(a){for(i in d)if(a==d[i].attr("id"))return void e._remove(d[i])},a.notification.debug=function(a){console.log(d[a])};var b=null,c=null,d=[],e={_log:function(){if(a.notification.options.debug)for(i in e._log.arguments)console.log("NOTIFICATION: "+e._log.arguments[i])},_overlay:{init:function(){b=a("<div/>").css({width:a(window).width()+"px",height:a(window).height()+"px"}).attr({id:"notification_overlay"}),a("body").append(b),a("#notification_overlay").append(a("<div/>").addClass("transparency")),a(window).resize(function(){b.css({width:a(window).width()+"px",height:a(window).height()+"px"}),e._center(c)})},display:function(){null==b&&this.init(),b.fadeIn(a.notification.options.fadeInSpeed)},hide:function(){b.fadeOut(a.notification.options.fadeOutSpeed)}},_center:function(b){var d=(a(window).height()-b.height())/2,e=(a(window).width()-b.width())/2;c.css({top:d+"px",left:e+"px"})},_slide:function(){var b=0,d=c.children();d.each(function(c){"hidden"==a(d[c]).css("visibility")&&(b+=a(d[c]).outerHeight())});var e=(a(window).height()-c.outerHeight()+b)/2+"px";c.animate({top:e},a.notification.options.moveSpeed)},_add:function(e,f,g,h){if("undefined"==typeof e||""==e)return this._log("ERROR: missing message parameter"),null;h="undefined"==typeof h?[]:h,g="undefined"==typeof g?a.notification.options.autoClose:g,this._overlay.display(),null==c&&(c=a("<div/>").attr("id","notification_container"),b.append(c));var j="message"+(new Date).getTime(),k=a("<div/>").css({display:"none"}).html(e).attr({id:j,"class":f});h.length>0&&k.append("<hr/>"),button_container=a("<div/>").addClass("notification_button_container");for(i in h){var l=a("<button/>").bind("click",h[i].click).addClass("notification_button").html(h[i].name);button_container.append(l)}return k.append(button_container),(a.notification.options.clickToClose&&0==h.length||!g&&0==l.length)&&(k.css("cursor","pointer"),k.click(function(){a.notification.close(j)})),c.append(k),k.ready(function(){k.height(k.height())}),d.length>0?this._slide():this._center(k),k.fadeIn(a.notification.options.fadeInSpeed,function(){k.find("input").length?k.find("input").focus():k.find("button:first-child").focus(),k.children("form").length&&k.children("form").submit(function(a){return k.find("button:first-child").click(),!1})}),a(document).on("keyup.notification",function(b){27==b.keyCode&&(a(document).unbind("keyup.notification"),k.find("button:last-child").click())}),d.push(k),g&&window.setTimeout("$.notification.close('"+k.attr("id")+"')",a.notification.options.autoCloseTime),j},_remove:function(b,c){"boolean"!=typeof c&&(c=!0),b.fadeOut(a.notification.options.fadeOutSpeed,function(){b.css({visibility:"hidden",display:"block"}),e._slide(),b.slideUp("fast",function(){b.remove()})}),c&&(d=a.grep(d,function(a,c){return a.attr("id")!=b.attr("id")})),0==d.length&&this._overlay.hide()}}}(jQuery),define("/home/basti/webcms2/zinstance/src/tud.addons.chat/tud/addons/chat/static/jquery.notification.js",function(){}),function(){var a=jQuery.event.special,b="D"+ +new Date,c="D"+(+new Date+1);a.scrollstart={setup:function(){var c,d=function(b){var d=this,e=arguments;c?clearTimeout(c):(b.type="scrollstart",jQuery.event.dispatch.apply(d,e)),c=setTimeout(function(){c=null},a.scrollstop.latency)};jQuery(this).bind("scroll",d).data(b,d)},teardown:function(){jQuery(this).unbind("scroll",jQuery(this).data(b))}},a.scrollstop={latency:300,setup:function(){var b,d=function(c){var d=this,e=arguments;b&&clearTimeout(b),b=setTimeout(function(){b=null,c.type="scrollstop",jQuery.event.dispatch.apply(d,e)},a.scrollstop.latency)};jQuery(this).bind("scroll",d).data(c,d)},teardown:function(){jQuery(this).unbind("scroll",jQuery(this).data(c))}}}(),define("/home/basti/webcms2/zinstance/src/tud.addons.chat/tud/addons/chat/static/jquery.scroll.js",function(){}),function(a,b){var c=function(a){var b=/(^|[^>\"\/])(http[s]{0,1}:\/\/|www\.)(?:[^\"])\S*([\s\)\!]|$)/gi,c="<a href=\"{0}\" target='_blank'>{1}</a>",f=/[\!\]\.\?]+$/g,a=a.replace(b,function(a,b,g,h,i,j){if(!a)return"";b&&(a=a.substr(1,a.length-1)),h&&(a=a.substr(0,a.length-1));var k=a.match(f);k&&(a=a.replace(f,"")),0!=a.search(/http/i)&&(a="http://"+a);var l=e(a,100);return b+String.format(c,d(a),d(l))+(k?k[0]:"")+h});return a},d=function(a){return a.replace(/(?:java|vb)?(?:script|data):/gi,"")},e=function(a,b){return b=b||20,a.length>b?a.slice(0,b-3)+"...":a};String.format=function(){for(var a=arguments[0],b=0;b<arguments.length-1;b++){var c=new RegExp("\\{"+b+"\\}","gm");a=a.replace(c,arguments[b+1])}return a},a.TudChatHyperlink=c}(this),define("/home/basti/webcms2/zinstance/src/tud.addons.chat/tud/addons/chat/static/hyperlink.js",function(){}),define("mockup-i18n",["jquery"],function(a){"use strict";var b=function(){var b=this;b.baseUrl=a("body").attr("data-i18ncatalogurl"),b.baseUrl||(b.baseUrl="/plonejsi18n"),b.currentLanguage=a("html").attr("lang")||"en-us",b.storage=null,b.catalogs={},b.ttl=864e5,Date.now||(Date.now=function(){return(new Date).valueOf()});try{"localStorage"in window&&null!==window.localStorage&&"JSON"in window&&null!==window.JSON&&(b.storage=window.localStorage)}catch(c){}b.configure=function(a){for(var c in a)b[c]=a[c]},b._setCatalog=function(a,c,d){a in b.catalogs?b.catalogs[a][c]=d:(b.catalogs[a]={},b.catalogs[a][c]=d)},b._storeCatalog=function(a,c,d){var e=a+"-"+c;null!==b.storage&&null!==d&&(b.storage.setItem(e,JSON.stringify(d)),b.storage.setItem(e+"-updated",Date.now()))},b.getUrl=function(a,c){return b.baseUrl+"?domain="+a+"&language="+c},b.loadCatalog=function(c,d){if(void 0===d&&(d=b.currentLanguage),null!==b.storage){var e=c+"-"+d;if(e in b.storage&&Date.now()-parseInt(b.storage.getItem(e+"-updated"),10)<b.ttl){var f=JSON.parse(b.storage.getItem(e));return void b._setCatalog(c,d,f)}}a.getJSON(b.getUrl(c,d),function(a){null!==a&&(b._setCatalog(c,d,a),b._storeCatalog(c,d,a))})},b.MessageFactory=function(a,c){return c=c||b.currentLanguage,function(d,e){var f;if(f=a in b.catalogs&&c in b.catalogs[a]&&d in b.catalogs[a][c]?b.catalogs[a][c][d]:d,e){var g,h;for(h in e)e.hasOwnProperty(h)&&(g=new RegExp("\\$\\{"+h+"\\}","g"),f=f.replace(g,e[h]))}return f}}};return b}),function(a,b){var c=function(){function a(a){var c=adminSpan=whisperSpan=whisperIcon="",d=B(a.message,a.attributes),f=TudChatHyperlink(d.message_content),g=[d.entry_classes],h=d.additional_content;e.admin&&g.push("admin"),a.name==e.ownUserName&&g.push("ownMessage"),"message"==e.dateFrequency&&(c=b("<span/>").addClass("chatdate").attr("data-time",a.date)),d.whisper_target?(g.push("whisper"),whisperSpan=b("<span class='additional_content' />").html(r(d.whisper_target,{preText:o("private_message_to")+" ",fromAdmin:e.admin})),whisperIcon=b("<span class='whisper-icon '/>")):e.admin&&(adminSpan=b("<span/>").addClass("adminActions").append(b("<a href='#' class='edit'>&nbsp;</a>").attr("data-mid",a.id).attr("title",o("edit_message"))).append(b("<a href='#' class='delete'>&nbsp;</a>").attr("data-mid",a.id).attr("title",o("delete_message"))));var i=r(a.name,{fromAdmin:e.admin,checkOnline:!0,toAdmin:d.admin_message}),j=b("<span class='message_content'/>").append(whisperSpan,b("<span class='message'/>").append(f));return""!=h&&j.append(b("<span class='additional_content'/>").append(h)),b("<div/>").attr("id","chatEntry"+a.id).addClass(g.join(" ")).append(b("<span class='meta-information'>").append(i,c,adminSpan),whisperIcon,b("<div/>").append(j))}function c(a,c){var d=r(a,{afterStart:!1,fromAdmin:e.admin,toAdmin:"admin"==c}),f=new Array;return a==e.ownUserName&&f.push("ownUsername"),f.push(c+"role"),b("<li/>").addClass("chatUser").addClass(f.join(" ")).append(d).prop("outerHTML")}var d={},e={admin:!1,welcomeMessage:""},f=new Date,g=null,h=!1,i=!1,j=!1,k=!0,l=new Date(0).setSeconds(0,0),m=null,n="en",o=null;b(function(){b("#chat").length&&(e=b.extend({},e,b("#chat").data()),n=b("html").attr("lang"),d.ajaxUrl=e.ajaxUrl,"function"==typeof require&&require.specified("mockup-i18n")?require(["mockup-i18n"],function(a){var b=new a;D(b)}):D(jarn.i18n))});var p=function(a){if(a||(a="sendMessage"),message=b("#chatMsgValue").val(),i||""==message&&"sendMessage"==a)return!1;i=!0,b("#chatMsgSubmit").attr("disabled","disabled").attr("isSending",!0),b("#chatMsgValue").val("").keyup();var c=m?{target_user:m}:{};C();var d=b.extend({},{method:a,message:message},c);b.post(e.ajaxUrl,d,function(a){y=x.alwaysBottom,u()}),window.setTimeout(function(){b("#chatMsgSubmit").removeAttr("disabled isSending"),b("#chatMsgValue").focus(),i=!1},e.blockTime)},q=function(){var a=window.location.href;"/"==a.substr(-1)&&(a=a.substr(0,a.length-2)),a=a.split("/"),room=/^[^\?]+/.exec(a.pop())[0],target_url=a.join("/")+"?room="+encodeURIComponent(room),window.location=target_url},r=function(a,c){var d={fromAdmin:!1,toAdmin:!1,afterStart:!0,checkOnline:!1,linkTitle:o("send_private_message",{user:a}),preText:"",fallback:!1};c=b.extend({},d,c);var f=new Array;if(c.toAdmin&&f.push("icon-view"),a==e.ownUserName&&f.push("self"),!("on"==e.whisper||"restricted"==e.whisper&&c.toAdmin||c.fromAdmin)||a==e.ownUserName||c.afterStart&&k||c.checkOnline&&!b("#userContainer a[data-uname='"+a+"']").length){if(c.fallback)return c.fallback;var g=b("<span class='username' />").addClass(f.join(" ")).append(a).prop("outerHTML");return c.preText+g}var h=c.linkTitle?c.linkTitle:"",i=b("<a href='#' class='username' />").attr("title",h).addClass(f.join(" ")).attr("data-uname",a).append(a).prop("outerHTML");return c.preText+i},s=function(a){var c="";"de"==n.substring(0,2)&&(c=" Uhr");var d=new Date,e="2-digit",f=b(a?"#chatContent .chatdate:empty":"#chatContent .chatdate");f.each(function(a,f){var g=b(f),h=g.data("time"),i=new Date(1e3*h),j=new Date(1e3*h);j.setHours(0,0,0,0)==d.setHours(0,0,0,0)?g.text(i.toLocaleTimeString(n,{hour:e,minute:e})+c):g.text(i.toLocaleString(n,{year:e,month:e,day:e,hour:e,minute:e})+c)})},t=function(){var a=new Date,b=a.getHours(),c=a.getMinutes(),d=a.getSeconds(),e=86400-60*b*60-60*c-d+3;window.setTimeout(function(){s(),t()},1e3*e)},u=function(d){h||(h=!0,b.post(e.ajaxUrl,{method:"getActions"},function(d){if(f=new Date,b("#chatMsgSubmit[isSending]").length||b("#chatMsgSubmit").removeAttr("disabled"),b("#chat .serverError:visible").fadeOut(400),1==d.status.code)return w(),void q();if(2==d.status.code)return w(),void q();if(3==d.status.code)return w(),void q();if(5==d.status.code&&b.notification.warn(o("warning")+"<br/><br/> <em>"+d.status.message+"</em>",!1,[{name:o("button_ok"),click:function(){b.notification.close(b(this).closest(".notification").attr("id"))}}]),!(d.status.code>5)){if("undefined"!=typeof d.users){if("undefined"!=typeof d.users["new"]){var g=function(a,b){return[!a.is_admin,a.name]>=[!b.is_admin,b.name]?1:-1},i=d.users["new"].sort(g);for(var m in i){var n=i[m].name,p=i[m].is_admin?"admin":"user",r=!1,t=b(c(n,p)).attr({"data-uname":n,title:"admin"==p?o("user_is_moderator",{user:n}):""});b("#userContainer").children().each(function(){var a=b(this).hasClass("adminrole"),c=b(this).text();if([!a,c]>=["admin"!=p,n])return b(this).before(t),r=!0,!1}),r||b("#userContainer").append(t)}if(!k){var u=b(i).map(function(){return b(this).attr("name")}).get();1==u.length?b("#chatContent").append(b("<div class='chat-info'/>").html(o("user_enters_room",{user:"<span class='username'>"+u+"</span>"}))):0!=u.length&&(last_user=u.pop(),b("#chatContent").append(b("<div class='chat-info'>").html(o("users_enter_room",{users:"<span class='username'>"+u.join(", ")+"</span>",last_user:"<span class='username'>"+last_user+"</span>"}))))}}if("undefined"!=typeof d.users.to_delete){i=d.users.to_delete.sort();for(var m in i)b("#chat .chatUser[data-uname='"+i[m]+"']").remove(),b("#chat a.username[data-uname='"+i[m]+"']").replaceWith(b("<span/>").addClass(b("#chat a.username[data-uname='"+i[m]+"']").attr("class")).append(i[m]));k||(1==i.length?b("#chatContent").append("<div class='chat-info'>"+o("user_leaves_room",{user:"<span class='username'>"+i[0]+"</span>"})+"</div>"):0!=i.length&&(last_user=i.pop(),b("#chatContent").append("<div class='chat-info'>"+o("users_leave_room",{users:"<span class='username'>"+i.join(", ")+"</span>",last_user:"<span class='username'>"+last_user+"</span>"})+"</div>")))}var v=b("#userContainer").children().length;v!=b("#userCount").text()&&b("#userCount").text(v)}if("undefined"!=typeof d.messages){if("undefined"!=typeof d.messages["new"]){var x=d.messages["new"];for(var m in d.messages["new"]){var y=new Date(1e3*x[m].date).setSeconds(0,0);("message"==e.dateFrequency||"minute"==e.dateFrequency&&y-l>=60)&&(l=y,b("#chatContent").append("<div class='chat-info'><span class='chatdate' data-time='"+x[m].date+"'></span></div>")),b("#chatContent").append(a(x[m]))}}if("undefined"!=typeof d.messages.to_edit){var z=d.messages.to_edit;for(var m in z)b("#chatEntry"+z[m].id).html(a(z[m]))}if("undefined"!=typeof d.messages.to_delete){var z=d.messages.to_delete;for(var m in z)console.log(z[m]),b("#chatEntry"+z[m].id).html(a(z[m]))}}if(s(!0),k&&e.welcomeMessage){var B=b("<div id='welcomeMessage' class='chat-info'></div>").text(e.welcomeMessage);b("#chatContent").append(B)}k=!1,h=!1,j||A()}}).fail(function(){h=!1,b("#chatMsgSubmit").attr("disabled","disabled"),b("#chat .serverError:hidden").fadeIn(400)}))},v=function(){null!=typeof g&&clearInterval(g);var a=(new Date-f)/2,b=Math.max(e.refreshRate,a);g=window.setTimeout(function(){u(),v()},Math.min(b,1e4))},w=function(){null!=typeof g&&clearInterval(g)},x={normal:0,alwaysBottom:1},y=x.alwaysBottom,z=function(){var a=b("#chatContent");y=a.scrollTop()+a.innerHeight()>=a[0].scrollHeight?x.alwaysBottom:x.normal},A=function(){var a=b("#chatContent");y!=x.alwaysBottom||a.scrollTop()+a.innerHeight()>=a[0].scrollHeight||a.scrollTop(a[0].scrollHeight)},B=function(a,b){var c="undefined"!=typeof a?a:"",d="",e="",f=null,g=!1;if("undefined"!=typeof b)for(var h=0;h<b.length;h++)"mod_edit_message"==b[h].a_action&&(d+=r(b[h].a_name,{preText:o("message_edited_by")+" ",toAdmin:!0}),e+=" admin_edit"),"mod_delete_message"==b[h].a_action&&(d=r(b[h].a_name,{preText:o("message_deleted_by")+" ",toAdmin:!0}),e+=" admin_delete"),1==b[h].admin_message&&(e+=" admin_message",g=!0),null!=b[h].whisper_target&&(f=b[h].whisper_target);return{entry_classes:e,message_content:c,additional_content:d,whisper_target:f,admin_message:g}},C=function(){m=null;var a=b("#chatMsgForm #chatMsgValue");b("#chatMsgForm #chatMsgTarget").remove(),a.css("padding-top",a.data("padding-top")).trigger("keyup").focus(),b("#chatMsgMoreButtons").hide()},D=function(a){a.loadCatalog("tud.addons.chat.js"),o=a.MessageFactory("tud.addons.chat.js"),d._=o,jQuery.ajaxSetup({cache:!1}),b("#chatMsgForm").submit(function(a){a.preventDefault();var c=b(this).find("button[type=submit]:focus"),d=c.data("method");p(d)}),b.post(e.ajaxUrl,{method:"resetLastAction"},function(a){e.welcomeMessage?u(e.welcomeMessage):u(),v()}),b("#logout").click(function(){h=!0,b.ajax({type:"POST",data:{method:"logout"},dataType:"text",url:e.ajaxUrl,success:function(a){q()},error:function(a,b,c){q()}})}),b("#chatUser button").click(function(){b("#chatUser #userContainer").toggle(),b("#chatUser .chatUsersArrow").toggleClass("icon-up").toggleClass("icon-down"),b("#userContainer:visible").length?b("body").on("click.chatUserContainer",function(a){0==b(a.target).closest("#userContainer, #chatUser button").length&&b("#chatUser button").click()}):b("body").off("click.chatUserContainer")}),b("#chatContent").delegate(".message_content a","click",function(a){b(this).hasClass("username")||b(a.target.parentNode.parentNode).hasClass("admin_message")||(b.notification.warn(o("link_warning_1")+"<br/><br/>"+o("link_warning_2",{link:"<tt>"+a.target.href+"</tt>"}),!1,[{name:o("button_yes"),click:function(){window.open(a.target.href,"_blank"),b.notification.clear()}},{name:o("button_no"),click:b.notification.clear}]),a.preventDefault())}),b("#chat").on("click","#chatUser li a, a.username",function(a){a.preventDefault(),C(),m=b(a.target).data("uname");var c=b('<span id="chatMsgTarget">'+o("message_to",{target:m})+' <a href="#" class="close"></a></span>'),d=b("#chatMsgForm #chatMsgValue");b("#chatMsgForm").prepend(c);var e=c.outerHeight(),f=d.css("padding-top");d.data("padding-top",f),d.css("padding-top","calc("+f+" + "+f+" + "+e+"px)").trigger("keyup").focus(),b("#chatMsgMoreButtons").css("display","inline-block"),b("#chatUser").click()}),b("#chatMsgForm").on("click","#chatMsgTarget a",function(a){a.preventDefault(),C()}),b("#chatContent").bind("scrollstart",function(){j=!0}),b("#chatContent").bind("scrollstop",function(){j=!1,z()}),e.maxMessageLength>0&&(b("#chatMsgValue").bind("keypress keyup",function(a){b("#counter").text(e.maxMessageLength-b("#chatMsgValue").val().length+" / "+e.maxMessageLength)}),b("#chatMsgValue").keypress());var c=b("#chatMsgValue"),f=c[0].offsetHeight-c[0].clientHeight;c.on("keyup",function(){b(this).css("height","").css("height",this.scrollHeight+f)}).keydown(function(a){var b=a.keyCode;13==b&&(a.preventDefault(),p()),8==b&&0==c.val().length&&C()});var g=function(){var a=b(window).height();b("#chatContent").height(.7*a)};b(window).resize(g),g(),t()};return d.updateCheck=u,d}();a.TudChat=c}(this,$),define("/home/basti/webcms2/zinstance/src/tud.addons.chat/tud/addons/chat/static/tud_chat.js",function(){});
//# sourceMappingURL=tud.addons.chat.min.js.map