<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"
  metal:use-macro="context/main_template/macros/master" i18n:domain="plone">


<head>
  <title>Chat</title>

<metal:block metal:fill-slot="javascript_head_slot">
    <script language="javascript" src="jquery.ba-dotimeout.min.js"></script>
    <script language="javascript" src="hyperlink.js"></script>
    <script language="javascript" src="jquery.notification.js"></script>
    <script language="javascript" src="jquery.scroll.js"></script>
    <script language="javascript" tal:condition="view/isAdmin" src="tud_chat_admin.js"></script>
    <script language="javascript" tal:condition="not: view/isAdmin" src="tud_chat_user.js"></script>
    <script language="javascript" src="tud_chat.js"></script>

    <script type="text/javascript" tal:define="chat_info view/getChatInformation"
                                   tal:content="structure string:var refreshRate = ${chat_info/refreshRate} * 1000; var blockTime = ${chat_info/blockTime} * 1000; var ownUsername = '${request/SESSION/user_properties/name|nothing}'; var ajax_url = '${context/absolute_url}/@@chatajax'; var maxMessageLength = ${chat_info/maxMessageLength}">
    </script>
</metal:block>

<metal:block metal:fill-slot="style_slot">
    <link rel="stylesheet" type="text/css" href="tud_chat.css" />
    <link rel="stylesheet" type="text/css" tal:condition="view/isAdmin" href="tud_chat_admin.css" />
    <link rel="stylesheet" type="text/css" tal:attributes="href string:${context/absolute_url}/tud_chat_additional.css" />
</metal:block>

</head>


<body metal:fill-slot="main" i18n:domain="tudchat" tal:define="chat_info view/getChatInformation;
                                                               session_info view/getSessionInformation;
                                                               whisper view/getWhisperOption;
                                                               max_msg_length chat_info/maxMessageLength">
    <h1 class="documentFirstHeading" tal:content="session_info/title"></h1>
    <tal:block define="description session_info/description"
               condition="description">
        <tal:block define="lines python:description.splitlines()">
            <p class="chat_description">
                <tal:block repeat="line lines">
                    <tal:block replace="line"></tal:block>
                    <br tal:condition="python: not repeat['line'].end">
                </tal:block>
            </p>
        </tal:block>
    </tal:block>
    <div id="chat" tal:attributes="data-welcome_message view/getWelcomeMessage;
                                   data-whisper whisper;
                                   data-date_frequency view/getDateFrequencyOption">
        <div id="chatContent">
        </div>
        <div id="chatMsg">
            <form id="chatMsgForm">
                <textarea type="text" name="msg" id="chatMsgValue" autocomplete="off" rows="1" placeholder="Bitte geben Sie hier Ihre Nachricht ein." tal:attributes="maxlength python: max_msg_length > 0 and max_msg_length or None; style python: max_msg_length > 0 and 'padding-right: 80px' or None"></textarea>
                <span id="counter" tal:condition="python: max_msg_length > 0">0</span>
                <button id="chatMsgSubmit" type="submit" title="Zum Absenden klicken oder mit 'Enter' bestätigen.">Absenden</button>
                <span id='chatMsgMoreButtons' tal:condition="view/isAdmin"><button class='moreButtonsExpand icon-down'></button>
                    <span class="buttonsWrapper">
                      <button data-method="warnUser" class='chatMsgMoreButton'>Warn</button>
                        <button data-method="kickUser" class='chatMsgMoreButton'>Kick</button>
                        <button data-method="banUser" class='chatMsgMoreButton'>Ban</button>
                    </span>
                </span>
            </form>
            <div id="chatUser">
                <button>
                  <span class="chatUsersIcon icon-local_roles"></span> <span id="userCount">1</span> <span class="chatUsersArrow icon-up"></span>
                </button>
                <ul id="userContainer">
                </ul>
            </div>
        </div>
    </div>
    <div id="chatAppendix">

        <h2>Hinweise zur Benutzung:</h2>
        <p tal:define="chat_end session_info/end_date;
                       chat_end python: chat_end.strftime('%d.%m.%Y, %H:%M Uhr')">
            Die Chatsitzungen werden von den <span class='admin icon-view'>gekennzeichneten Personen</span> moderiert. Chatnutzer können bei Fehlverhalten verwarnt, aus dem Chat entfernt oder permanent verwiesen werden.
            <span class="chatDuration" tal:content="string: Diese Chatsitzung ist bis zum ${chat_end} aktiv und wird anschließend automatisch geschlossen."></span>
            <tal:block condition="python: whisper == 'restricted'">
                In diesem Chat können Sie private Nachrichten verschicken, die nur für Sie und den adressierten Moderatoren sichtbar sind. Klicken Sie dafür auf den entsprechenden Nutzernamen.
            </tal:block>
            <tal:block condition="python: whisper == 'on'">
                In diesem Chat können Sie private Nachrichten verschicken, die nur für Sie und den Adressaten sichtbar sind. Klicken Sie dafür auf den entsprechenden Nutzernamen.
            </tal:block>
        </p>

        <p>
            <button id="logout">Chatsitzung verlassen</button>
        </p>
    </div>
</body>
</html>